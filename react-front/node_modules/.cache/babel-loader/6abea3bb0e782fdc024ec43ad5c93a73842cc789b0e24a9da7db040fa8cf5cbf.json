{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Afthercaft\\\\Pictures\\\\ApiReact\\\\react-front\\\\src\\\\context\\\\authContext.jsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\n// authContext.js\nimport { createContext, useContext, useState, useEffect } from \"react\";\nimport { loginRequest, registerRequest, verifyTokenRequest } from \"../AuthP/auth\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AuthContext = /*#__PURE__*/createContext();\nexport const useAuth = () => {\n  _s();\n  const context = useContext(AuthContext);\n  if (!context) throw new Error(\"useAuth must be used within an AuthProvider\");\n  return context;\n};\n_s(useAuth, \"b9L3QQ+jgeyIrH0NfHrJ8nn7VMU=\");\nconst ERROR_TIMEOUT = 5000;\nexport const AuthProvider = ({\n  children\n}) => {\n  _s2();\n  const [user, setUser] = useState(null);\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\n  const [errors, setErrors] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [role, setRole] = useState(''); // Agrega estado para el rol del usuario\n\n  useEffect(() => {\n    let timer;\n    if (errors.length > 0) {\n      timer = setTimeout(() => {\n        setErrors([]);\n      }, ERROR_TIMEOUT);\n    }\n    return () => clearTimeout(timer);\n  }, [errors]);\n  const signup = async user => {\n    try {\n      const res = await registerRequest(user);\n      const {\n        userData,\n        token\n      } = res.data;\n      // Se asume que userData.id es generado automáticamente y no es necesario pasarlo en la solicitud\n      setUser({\n        id: userData.id,\n        fullname: userData.fullname,\n        username: userData.username\n      });\n      setIsAuthenticated(true);\n      localStorage.setItem(\"token\", token);\n      localStorage.setItem(\"userId\", userData.id);\n      setRole(userData.role); // Establece el rol del usuario después de registrarse\n    } catch (error) {\n      var _error$response, _error$response2, _error$response2$data;\n      console.error(\"Error during signup:\", ((_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.data) || error.message);\n      setErrors([((_error$response2 = error.response) === null || _error$response2 === void 0 ? void 0 : (_error$response2$data = _error$response2.data) === null || _error$response2$data === void 0 ? void 0 : _error$response2$data.message) || \"Unknown error\"]);\n    }\n  };\n  const signin = async user => {\n    try {\n      const res = await loginRequest(user);\n      const {\n        id,\n        fullname,\n        username,\n        token,\n        role\n      } = res.data; // Extrae el rol desde la respuesta\n      setUser({\n        id,\n        fullname,\n        username\n      });\n      setIsAuthenticated(true);\n      localStorage.setItem(\"token\", token);\n      localStorage.setItem(\"userId\", id);\n      setRole(role); // Establece el rol del usuario después de iniciar sesión\n      return res;\n    } catch (error) {\n      var _error$response3, _error$response4, _error$response4$data;\n      console.error(\"Error during signin:\", ((_error$response3 = error.response) === null || _error$response3 === void 0 ? void 0 : _error$response3.data) || error.message);\n      setErrors([((_error$response4 = error.response) === null || _error$response4 === void 0 ? void 0 : (_error$response4$data = _error$response4.data) === null || _error$response4$data === void 0 ? void 0 : _error$response4$data.message) || \"Unknown error\"]);\n      throw error;\n    }\n  };\n  const logout = () => {\n    localStorage.removeItem(\"token\");\n    localStorage.removeItem(\"userId\");\n    setUser(null);\n    setIsAuthenticated(false);\n    setRole(''); // Limpia el rol al cerrar sesión\n  };\n  useEffect(() => {\n    const checkLogin = async () => {\n      const token = localStorage.getItem(\"token\");\n      const userId = localStorage.getItem(\"userId\");\n      if (!token || !userId) {\n        setIsAuthenticated(false);\n        setLoading(false);\n        return;\n      }\n      try {\n        const res = await verifyTokenRequest(token);\n        if (res.data) {\n          setIsAuthenticated(true);\n          setUser({\n            id: userId\n          });\n          setRole(res.data.role); // Establece el rol del usuario después de verificar el token\n        } else {\n          setIsAuthenticated(false);\n          setUser(null);\n        }\n      } catch (error) {\n        var _error$response5;\n        console.error(\"Error during token verification:\", ((_error$response5 = error.response) === null || _error$response5 === void 0 ? void 0 : _error$response5.data) || error.message);\n        setIsAuthenticated(false);\n        setUser(null);\n      } finally {\n        setLoading(false);\n      }\n    };\n    checkLogin();\n  }, []);\n  const value = {\n    user,\n    setUser,\n    signup,\n    signin,\n    logout,\n    isAuthenticated,\n    errors,\n    loading,\n    role // Exponer el rol en el valor del contexto\n  };\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: value,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 118,\n    columnNumber: 5\n  }, this);\n};\n_s2(AuthProvider, \"aBxPmsYHmbXKHw3cQO/+giuS0+E=\");\n_c = AuthProvider;\nexport { AuthContext };\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["createContext","useContext","useState","useEffect","loginRequest","registerRequest","verifyTokenRequest","jsxDEV","_jsxDEV","AuthContext","useAuth","_s","context","Error","ERROR_TIMEOUT","AuthProvider","children","_s2","user","setUser","isAuthenticated","setIsAuthenticated","errors","setErrors","loading","setLoading","role","setRole","timer","length","setTimeout","clearTimeout","signup","res","userData","token","data","id","fullname","username","localStorage","setItem","error","_error$response","_error$response2","_error$response2$data","console","response","message","signin","_error$response3","_error$response4","_error$response4$data","logout","removeItem","checkLogin","getItem","userId","_error$response5","value","Provider","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/Users/Afthercaft/Pictures/ApiReact/react-front/src/context/authContext.jsx"],"sourcesContent":["// authContext.js\r\nimport { createContext, useContext, useState, useEffect } from \"react\";\r\nimport { loginRequest, registerRequest, verifyTokenRequest } from \"../AuthP/auth\";\r\n\r\nconst AuthContext = createContext();\r\n\r\nexport const useAuth = () => {\r\n  const context = useContext(AuthContext);\r\n  if (!context) throw new Error(\"useAuth must be used within an AuthProvider\");\r\n  return context;\r\n};\r\n\r\nconst ERROR_TIMEOUT = 5000;\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n  const [user, setUser] = useState(null);\r\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\r\n  const [errors, setErrors] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [role, setRole] = useState(''); // Agrega estado para el rol del usuario\r\n\r\n  useEffect(() => {\r\n    let timer;\r\n    if (errors.length > 0) {\r\n      timer = setTimeout(() => {\r\n        setErrors([]);\r\n      }, ERROR_TIMEOUT);\r\n    }\r\n    return () => clearTimeout(timer);\r\n  }, [errors]);\r\n\r\n  const signup = async (user) => {\r\n    try {\r\n      const res = await registerRequest(user);\r\n      const { userData, token } = res.data;\r\n      // Se asume que userData.id es generado automáticamente y no es necesario pasarlo en la solicitud\r\n      setUser({ id: userData.id, fullname: userData.fullname, username: userData.username });\r\n      setIsAuthenticated(true);\r\n      localStorage.setItem(\"token\", token);\r\n      localStorage.setItem(\"userId\", userData.id);\r\n      setRole(userData.role); // Establece el rol del usuario después de registrarse\r\n    } catch (error) {\r\n      console.error(\"Error during signup:\", error.response?.data || error.message);\r\n      setErrors([error.response?.data?.message || \"Unknown error\"]);\r\n    }\r\n  };\r\n  \r\n\r\n  const signin = async (user) => {\r\n    try {\r\n      const res = await loginRequest(user);\r\n      const { id, fullname, username, token, role } = res.data; // Extrae el rol desde la respuesta\r\n      setUser({ id, fullname, username });\r\n      setIsAuthenticated(true);\r\n      localStorage.setItem(\"token\", token);\r\n      localStorage.setItem(\"userId\", id);\r\n      setRole(role); // Establece el rol del usuario después de iniciar sesión\r\n      return res;\r\n    } catch (error) {\r\n      console.error(\"Error during signin:\", error.response?.data || error.message);\r\n      setErrors([error.response?.data?.message || \"Unknown error\"]);\r\n      throw error;\r\n    }\r\n  };\r\n\r\n  const logout = () => {\r\n    localStorage.removeItem(\"token\");\r\n    localStorage.removeItem(\"userId\");\r\n    setUser(null);\r\n    setIsAuthenticated(false);\r\n    setRole(''); // Limpia el rol al cerrar sesión\r\n  };\r\n\r\n  useEffect(() => {\r\n    const checkLogin = async () => {\r\n      const token = localStorage.getItem(\"token\");\r\n      const userId = localStorage.getItem(\"userId\");\r\n      if (!token || !userId) {\r\n        setIsAuthenticated(false);\r\n        setLoading(false);\r\n        return;\r\n      }\r\n\r\n      try {\r\n        const res = await verifyTokenRequest(token);\r\n        if (res.data) {\r\n          setIsAuthenticated(true);\r\n          setUser({ id: userId });\r\n          setRole(res.data.role); // Establece el rol del usuario después de verificar el token\r\n        } else {\r\n          setIsAuthenticated(false);\r\n          setUser(null);\r\n        }\r\n      } catch (error) {\r\n        console.error(\"Error during token verification:\", error.response?.data || error.message);\r\n        setIsAuthenticated(false);\r\n        setUser(null);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n    checkLogin();\r\n  }, []);\r\n\r\n  const value = {\r\n    user,\r\n    setUser,\r\n    signup,\r\n    signin,\r\n    logout,\r\n    isAuthenticated,\r\n    errors,\r\n    loading,\r\n    role, // Exponer el rol en el valor del contexto\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider value={value}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n\r\nexport { AuthContext };\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}